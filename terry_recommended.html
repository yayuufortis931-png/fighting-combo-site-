<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ†ãƒªãƒ¼ãŠã™ã™ã‚ã‚³ãƒ³ãƒœ</title>
<style>
body { 
  font-family: Arial, sans-serif; 
  padding: 20px; 
  background: #f9f9f9; 
}
h2 { 
  text-align: center; 
  margin-bottom: 30px; 
}

/* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
.back-buttons { 
  margin-bottom: 20px; 
  text-align: center; 
}
.back-buttons button {
  margin: 0 5px;
  padding: 6px 12px;
  border: none;
  border-radius: 5px;
  background: #888;
  color: #fff;
  cursor: pointer;
}

/* æ¨ªä¸¦ã³ãƒ©ãƒƒãƒ‘ãƒ¼ */
.combo-row-wrapper {
  display: flex;
  align-items: flex-start;
  gap: 12px; 
  margin-bottom: 25px;
  flex-wrap: wrap; /* ã‚¹ãƒãƒ›ã§ã‚‚æŠ˜ã‚Šè¿”ã— */
  position: relative; /* SVGé…ç½®ç”¨ */
}

/* ã‚³ãƒ³ãƒœã‚«ãƒ¼ãƒ‰ */
.combo-card {
  background: #f0f0f0;
  border-radius: 12px;
  padding: 15px;
  flex: 1;
  display: flex;
  flex-direction: column;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  position: relative;
}

/* ã‚¿ã‚¤ãƒˆãƒ« */
.combo-title { 
  font-weight: bold; 
  font-size: 16px; 
  margin-bottom: 10px; 
  text-align: left;
  padding: 5px 0;
}

/* æŠ€ç”»åƒã‚³ãƒ³ãƒ†ãƒŠ */
.moves-container { 
  display: flex; 
  flex-wrap: wrap; 
  gap: 10px;
  position: relative;
}

.moves-container img { 
  width: 120px; 
  height: 120px; 
  object-fit: contain; 
  border: none;
  border-radius: 8px; 
  background: #f9f9f9; 
  padding: 0; 
  position: relative;
  z-index: 1;
}

/* ã‚µã‚¤ãƒ‰ãƒãƒŠãƒ¼ */
.side-banner {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  color: #000;
  font-size: 12px;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 5px;
  width: 100px;
  flex-shrink: 0;
}

/* Amazonãƒ­ã‚´ */
.amazon-logo {
  width: 30px;
  margin-top: 2px;
}

/* ã‚¹ãƒãƒ›å¯¾å¿œ */
@media (max-width: 480px) {
  .combo-row-wrapper {
    flex-direction: column;
  }
  .side-banner {
    width: 60px;
    font-size: 10px;
    padding: 3px;
  }
  .side-banner img {
    width: 60px;
    height: auto;
    margin-bottom: 2px;
  }
  .amazon-logo {
    width: 25px;
  }
}

/* ç·šç”¨SVG */
.line-overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
  z-index: 0;
}
</style>
</head>
<body>

<h2>ãƒ†ãƒªãƒ¼ãŠã™ã™ã‚ã‚³ãƒ³ãƒœ</h2>

<div class="back-buttons">
  <button onclick="location.href='index.html'">ğŸ  ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
  <button onclick="location.href='terry.html'">âœï¸ ã‚³ãƒ³ãƒœç®¡ç†ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</button>
</div>

<div id="combo-display"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

// Firebase è¨­å®š
const firebaseConfig = {
  apiKey: "AIzaSyAD4fyc-1VlEEGGO631hhpZqCOqllrQ3og",
  authDomain: "st6-combo-maker.firebaseapp.com",
  projectId: "st6-combo-maker",
  storageBucket: "st6-combo-maker.firebasestorage.app",
  messagingSenderId: "945906359459",
  appId: "1:945906359459:web:59a955b609426cf2893316",
  measurementId: "G-YVFY7H6N9E"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const comboDisplay = document.getElementById("combo-display");

// ã‚µã‚¤ãƒ‰ãƒãƒŠãƒ¼ç”¨å•†å“ãƒªã‚¹ãƒˆ
const affiliateItems = [
  { link:"https://amzn.to/45LDjGS", img:"https://m.media-amazon.com/images/I/71efVUNIBmL._AC_SL1500_.jpg", title:"BLITZ2" },
  { link:"https://amzn.to/4ng309J", img:"https://m.media-amazon.com/images/I/71a0xYAmg0L._AC_SX679_.jpg", title:"Haute42 ã‚¢ã‚±ã‚³ãƒ³" },
  { link:"https://amzn.to/41h5CLP", img:"https://m.media-amazon.com/images/I/61T5L-yGdJL._AC_SX679_.jpg", title:"ãƒ•ã‚¡ã‚¤ãƒ†ã‚£ãƒ³ã‚°ã‚¹ãƒ†ã‚£ãƒƒã‚¯Î±" },
  { link:"https://amzn.to/463TZdK", img:"https://m.media-amazon.com/images/I/61ZkF5cY7zL._AC_SY450_.jpg", title:"Elgato Wave:3" },
  { link:"https://amzn.to/47JHeq7", img:"https://m.media-amazon.com/images/I/61uDYXfqtxL._AC_SX679_.jpg", title:"ãƒ­ã‚¸ã‚¯ãƒ¼ãƒ« MX MASTER3s" },
  { link:"https://amzn.to/3VcypNZ", img:"https://m.media-amazon.com/images/I/61euaIRYGXL._AC_SY300_SX300_QL70_ML2_.jpg", title:"HyperX QuadCast S" }
];

const amazonLogo = "https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg";

// ãƒ†ãƒªãƒ¼ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
const docRef = doc(db, "combos", "ãƒ†ãƒªãƒ¼");

// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾—
onSnapshot(docRef, (docSnap) => {
  comboDisplay.innerHTML = "";
  if (docSnap.exists()) {
    const rows = docSnap.data().rows || [];
    rows.forEach((r, index) => {
      const wrapper = document.createElement("div");
      wrapper.className = "combo-row-wrapper";

      // ã‚³ãƒ³ãƒœã‚«ãƒ¼ãƒ‰
      const card = document.createElement("div");
      card.className = "combo-card";

      const title = document.createElement("div");
      title.className = "combo-title";
      title.textContent = r.title;
      card.appendChild(title);

      const movesContainer = document.createElement("div");
      movesContainer.className = "moves-container";

      const imgElements = {};
      r.moves.forEach(mv => {
        const img = document.createElement("img");
        img.src = `images/terry/${mv}.png`;
        img.alt = mv;
        img.dataset.id = mv; // è­˜åˆ¥ç”¨
        movesContainer.appendChild(img);
        imgElements[mv] = img;
      });

      card.appendChild(movesContainer);
      wrapper.appendChild(card);

      // ç·šæç”»ç”¨SVG
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.classList.add("line-overlay");
      wrapper.appendChild(svg);

      // connection ãŒã‚ã‚Œã°ç·šã‚’æç”»
      if (r.connections && r.connections.from && r.connections.to) {
        requestAnimationFrame(() => {
          const fromEl = imgElements[r.connections.from];
          const toEl   = imgElements[r.connections.to];
          if (fromEl && toEl) {
            const fromRect = fromEl.getBoundingClientRect();
            const toRect   = toEl.getBoundingClientRect();
            const wrapperRect = wrapper.getBoundingClientRect();

            const x1 = fromRect.left + fromRect.width/2 - wrapperRect.left;
            const y1 = fromRect.top + fromRect.height/2 - wrapperRect.top;
            const x2 = toRect.left + toRect.width/2 - wrapperRect.left;
            const y2 = toRect.top + toRect.height/2 - wrapperRect.top;

            const line = document.createElementNS("http://www.w3.org/2000/svg","line");
            line.setAttribute("x1", x1);
            line.setAttribute("y1", y1);
            line.setAttribute("x2", x2);
            line.setAttribute("y2", y2);
            line.setAttribute("stroke", "green");
            line.setAttribute("stroke-width", "16");
            line.setAttribute("stroke-linecap", "round");
            svg.appendChild(line);
          }
        });
      }

      // ã‚µã‚¤ãƒ‰ãƒãƒŠãƒ¼
      const item = affiliateItems[index % affiliateItems.length];
      const sideLink = document.createElement("a");
      sideLink.href = item.link;
      sideLink.target = "_blank";
      sideLink.className = "side-banner";

      const sideImg = document.createElement("img");
      sideImg.src = item.img;
      sideImg.alt = item.title;
      sideLink.appendChild(sideImg);

      const sideTitle = document.createElement("div");
      sideTitle.textContent = item.title;
      sideLink.appendChild(sideTitle);

      const logoImg = document.createElement("img");
      logoImg.src = amazonLogo;
      logoImg.className = "amazon-logo";
      sideLink.appendChild(logoImg);

      wrapper.appendChild(sideLink);
      comboDisplay.appendChild(wrapper);
    });
  } else {
    comboDisplay.innerHTML = "<p>ãŠã™ã™ã‚ã‚³ãƒ³ãƒœãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>";
  }
});
</script>

</body>
</html>
