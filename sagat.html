<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚µã‚¬ãƒƒãƒˆ ã‚³ãƒ³ãƒœç®¡ç†</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
#page-nav { margin-bottom: 20px; }
#page-nav button { margin-right: 10px; padding: 5px 10px; }
.combo-row { margin-bottom: 25px; padding: 10px; border: 2px solid #666; border-radius: 8px; background: #f0f0f0; position: relative; }
.row-header { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 8px; }
.row-title { font-weight: bold; font-size: 16px; padding: 5px; flex: 1; }
.row-delete-btn, .row-duplicate-btn { background: red; color: white; border: none; border-radius: 5px; padding: 4px 8px; cursor: pointer; flex-shrink: 0; }
.row-duplicate-btn { background: orange; }
.controls { margin: 10px 0; }
.image-container { display: flex; gap: 10px; flex-wrap: wrap; }
.image-box { position: relative; width: 120px; height: 120px; border: 2px solid #ccc; border-radius: 8px; overflow: hidden; background: #f9f9f9; cursor: grab; }
.image-box img { width: 100%; height: 100%; object-fit: contain; }
.delete-btn { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; }
.drag-over { border: 2px dashed #007bff; }
</style>
</head>
<body>
<h2>ã‚µã‚¬ãƒƒãƒˆ ã‚³ãƒ³ãƒœç®¡ç†</h2>
<div id="page-nav"></div>
<button id="add-page-btn">ï¼‹ ãƒšãƒ¼ã‚¸è¿½åŠ </button>
<button id="save-btn">ğŸ’¾ ä¿å­˜</button>
<button id="back-main">ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</button>
<button id="add-row-btn">ï¼‹ æ®µã‚’è¿½åŠ </button>
<div id="combo-area"></div>

<script>
const comboArea = document.getElementById("combo-area");
const pageNav = document.getElementById("page-nav");
const addPageBtn = document.getElementById("add-page-btn");
const saveBtn = document.getElementById("save-btn");
const backMainBtn = document.getElementById("back-main");
const addRowBtn = document.getElementById("add-row-btn");

let pages = ["default","recommended"]; // åˆæœŸ2ãƒšãƒ¼ã‚¸
let currentPage = pages[0];
let rowCount = 0;

const moveList = [
      "5å¼±P","2å¼±P","5å¼±K","6å¼±K","2å¼±K",
      "5ä¸­P","6ä¸­P","2ä¸­P","5ä¸­K","2ä¸­K",
      "5å¼·P","4å¼·P","2å¼·P","5å¼·K","5å¼·K(1æ®µç›®)","6å¼·K","2å¼·K",
      "2ä¸­P2å¼·P","2ä¸­P2å¼·K","5ä¸­K5å¼·K","5å¼·P5å¼·K",
      "å¼±ã‚¿ã‚¤ã‚¬ãƒ¼ã‚·ãƒ§ãƒƒãƒˆ","ä¸­ã‚¿ã‚¤ã‚¬ãƒ¼ã‚·ãƒ§ãƒƒãƒˆ","å¼·ã‚¿ã‚¤ã‚¬ãƒ¼ã‚·ãƒ§ãƒƒãƒˆ","ODã‚¿ã‚¤ã‚¬ãƒ¼ã‚·ãƒ§ãƒƒãƒˆ",
      "å¼±ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¢ãƒ‘ã‚«","ä¸­ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¢ãƒ‘ã‚«","å¼·ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¢ãƒ‘ã‚«","æºœã‚ã‚¢ãƒ‘ã‚«","ODã‚¿ã‚¤ã‚¬ãƒ¼ã‚¢ãƒ‘ã‚«",
      "å¼±ã‚¿ã‚¤ã‚¬ãƒ¼ãƒ‹ãƒ¼","ä¸­ã‚¿ã‚¤ã‚¬ãƒ¼ãƒ‹ãƒ¼","å¼·ã‚¿ã‚¤ã‚¬ãƒ¼ãƒ‹ãƒ¼","ODã‚¿ã‚¤ã‚¬ãƒ¼ãƒ‹ãƒ¼",
      "å¼±ã‚¿ã‚¤ã‚¬ãƒ¼ãƒã‚¯ã‚µã‚¹","ä¸­ã‚¿ã‚¤ã‚¬ãƒ¼ãƒã‚¯ã‚µã‚¹","å¼·ã‚¿ã‚¤ã‚¬ãƒ¼ãƒã‚¯ã‚µã‚¹","ODã‚¿ã‚¤ã‚¬ãƒ¼ãƒã‚¯ã‚µã‚¹",
      "å¼±æ´¾ç”Ÿ","ä¸­æ´¾ç”Ÿ","å¼·æ´¾ç”Ÿ",
      "SA1","SA2","SA3",
      "ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒƒã‚·ãƒ¥","ãƒ‰ãƒ©ã‚¤ãƒ–ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ","æŠ•ã’","ã‚¸ãƒ£ãƒ³ãƒ—","å‰ã‚¹ãƒ†ãƒƒãƒ—",
      "Jå¼±P","Jä¸­P","Jå¼·P","Jå¼±K","Jä¸­K","Jå¼·K"
    ];

const imageMap = {};
moveList.forEach(move=>{ imageMap[move]=`images/sagat/${move}.png`; });

// --- ãƒšãƒ¼ã‚¸åˆ‡æ›¿
function renderPageNav(){
  pageNav.innerHTML="";
  pages.forEach(p=>{
    const btn = document.createElement("button");
    btn.textContent=p;
    btn.dataset.page=p;
    if(p===currentPage) btn.style.fontWeight="bold";
    btn.addEventListener("click",()=>{
      saveCurrentPage();
      currentPage = p;
      loadPage();
      renderPageNav();
    });
    pageNav.appendChild(btn);
    // å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆåˆæœŸãƒšãƒ¼ã‚¸ä»¥å¤–ï¼‰
    if(!["default","recommended"].includes(p)){
      const delBtn = document.createElement("button");
      delBtn.textContent="Ã—";
      delBtn.addEventListener("click",()=>{
        pages = pages.filter(pageName=>pageName!==p);
        localStorage.removeItem(`comboData_${p}`);
        if(currentPage===p) currentPage="default";
        loadPage();
        renderPageNav();
      });
      pageNav.appendChild(delBtn);
    }
  });
}
renderPageNav();

// --- ãƒšãƒ¼ã‚¸è¿½åŠ 
addPageBtn.addEventListener("click",()=>{
  let name = prompt("æ–°ã—ã„ãƒšãƒ¼ã‚¸åã‚’å…¥åŠ›");
  if(!name) return;
  if(pages.includes(name)){ alert("ã™ã§ã«å­˜åœ¨ã™ã‚‹ãƒšãƒ¼ã‚¸åã§ã™"); return; }
  pages.push(name);
  currentPage = name;
  loadPage();
  renderPageNav();
});

// --- æˆ»ã‚‹
backMainBtn.addEventListener("click",()=>location.href="index.html");

// --- ä¿å­˜
saveBtn.addEventListener("click",()=>{ saveCurrentPage(); alert("ä¿å­˜ã—ã¾ã—ãŸï¼"); });

function saveCurrentPage(){
  const data=[];
  document.querySelectorAll(".combo-row").forEach(row=>{
    const title=row.querySelector(".row-title").value;
    const moves=[...row.querySelectorAll(".image-box img")].map(img=>img.alt);
    data.push({title,moves});
  });
  localStorage.setItem(`comboData_${currentPage}`,JSON.stringify(data));
}

// --- ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿
function loadPage(){
  comboArea.innerHTML="";
  rowCount=0;
  const data=JSON.parse(localStorage.getItem(`comboData_${currentPage}`)||"[]");
  data.forEach(d=>addRow(d));
}

// --- æ®µè¿½åŠ 
addRowBtn.addEventListener("click",()=>addRow());

function addRow(savedData=null){
  rowCount++;
  const rowDiv=document.createElement("div");
  rowDiv.classList.add("combo-row");

  const header=document.createElement("div"); header.classList.add("row-header");

  const titleInput=document.createElement("input"); titleInput.type="text";
  titleInput.value=savedData?.title||`ã‚³ãƒ³ãƒœ${rowCount}`; titleInput.classList.add("row-title");

  const deleteBtn=document.createElement("button");
  deleteBtn.textContent="Ã—æ®µå‰Šé™¤"; deleteBtn.classList.add("row-delete-btn");
  deleteBtn.addEventListener("click",()=>rowDiv.remove());

  const duplicateBtn=document.createElement("button");
  duplicateBtn.textContent="è¤‡è£½"; duplicateBtn.classList.add("row-duplicate-btn");
  duplicateBtn.addEventListener("click",()=>duplicateRow(rowDiv));

  header.appendChild(titleInput); header.appendChild(deleteBtn); header.appendChild(duplicateBtn);

  const controls=document.createElement("div"); controls.classList.add("controls");
  const select=document.createElement("select");
  const defaultOption=document.createElement("option"); defaultOption.value=""; defaultOption.textContent="æŠ€ã‚’é¸æŠã—ã¦ãã ã•ã„"; select.appendChild(defaultOption);
  moveList.forEach(move=>{ const o=document.createElement("option"); o.value=move; o.textContent=move; select.appendChild(o); });
  const addBtn=document.createElement("button"); addBtn.textContent="è¿½åŠ "; controls.appendChild(select); controls.appendChild(addBtn);

  const container=document.createElement("div"); container.classList.add("image-container");

  addBtn.addEventListener("click",()=>{ const move=select.value; if(move && imageMap[move]) addImageBox(container,move); });
  if(savedData?.moves) savedData.moves.forEach(m=>addImageBox(container,m));

  rowDiv.appendChild(header); rowDiv.appendChild(controls); rowDiv.appendChild(container);
  comboArea.appendChild(rowDiv);
}

function duplicateRow(row){
  const title=row.querySelector(".row-title").value+"_ã‚³ãƒ”ãƒ¼";
  const moves=[...row.querySelectorAll(".image-box img")].map(img=>img.alt);
  addRow({title,moves});
}

function addImageBox(container,move){
  const box=document.createElement("div"); box.classList.add("image-box"); box.draggable=true;
  const img=document.createElement("img"); img.src=imageMap[move]; img.alt=move;
  const delBtn=document.createElement("button"); delBtn.textContent="Ã—"; delBtn.classList.add("delete-btn"); delBtn.addEventListener("click",()=>box.remove());
  box.appendChild(img); box.appendChild(delBtn); container.appendChild(box); addDragAndDrop(box,container);
}

// --- ãƒ‰ãƒ©ãƒƒã‚°ä¸¦ã¹æ›¿ãˆ
function addDragAndDrop(element,container){
  element.addEventListener("dragstart",(e)=>{ e.dataTransfer.setData("text/plain",""); element.classList.add("dragging"); });
  element.addEventListener("dragend",()=>{ element.classList.remove("dragging"); });
  container.addEventListener("dragover",(e)=>{ e.preventDefault();
    const dragging=container.querySelector(".dragging");
    const after=getDragAfterElement(container,e.clientY);
    if(after==null) container.appendChild(dragging); else container.insertBefore(dragging,after);
  });
}
function getDragAfterElement(container,y){
  const elements=[...container.querySelectorAll(".image-box:not(.dragging)")];
  return elements.find(el=>{const rect=el.getBoundingClientRect(); return y<rect.top+rect.height/2;});
}

// --- åˆå›ãƒ­ãƒ¼ãƒ‰
loadPage();
</script>
</body>
</html>
